var cards = {
    start: [
        "Il n'y a pas de secrets, ____ est obligatoire pour réussir un mariage.",
        "Quand je vois ______, ça me fait bander.",
        "________, il n'y a que ça de bon !",
        "Selon le médecin légiste, la cause du décès est ________.",
        "Pour survivre a ma belle mère j'ai du ________",
        "Qu'est ce qui est pire que Donald Trump ?",
        "Je me méfie toujours quand on me parle de ________",
        "C'est a cause de ______ que je suis en psychanalyse.",
        "Elle m'a dit 'si tu veux qu'on reste ensemble' tu dois arrêter de ______",
        "Impossible de dormir depuis que j'ai vu cette vidéo sur _____",
        "J'aimerais trouver une pilule qui me permettrait d'oublier ____",
        "C'est l'heure de filer , je dois ______",
        "Je suis hétéro mais ____ pourrait me rendre gay",
        "Je suis toujours gêné quand mamie me parle de ses histoires de ______.",
        "Les migrants viennent en Belgique pour _______.",
        "Les toilettes maternelle, l'endroit rêvé pour ________.",
        "Je l'ai larguée quand j'ai découvert qu'elle aimait ________",
        "Cette année les Enfoirés vont collecter des fonds pour promouvoir ______.",
        "Il n'est jamais trop tard pour ________.",
        "Je lance mon nouveau site : _________.be",
        "Je suis pas sur que tu vas accepter, mais je te propose ______.",
        "La partouze s'est arrêtée quand on a du retirer _______ du fion de Dédé",
        "Mon dieu... Merci pour _________",
        "Pire que le cancer, pire que le sida, il y a __________",
        "Pour noël ma grand mère m'a offert _________",
        "Manger bio c'est bien, manger _________ c'est mieux.",
        "Hier j'ai regardé ____________.... PLUS JAMAIS.....",
        "Avec l'état d'urgence, les policiers ont maintenant le droit de ___________",
        "Ce matin je me suis réveillé avec une terrible envie de _________",
        "__________, ma technique pour éviter la gaule du matin",
        "Après une rupture, pas le choix, je ____________",
        "J'ai essayé _______, c'était moins bien que prévu",
        "Je l'ai larguée quand j'ai découvert qu'elle aimait",
        "Pour devenir athlète, il n'y a qu'une seule solution: __________",
        "Les carolos ont la facheuse tendance de ___________",
        "A dinant, _________ est une pratique très répandue ( Surtout a Wespin en fait )",
        "Papa, on fait quoi pour les vacances ? _________________",
        "Pour éviter l'éjaculation précoce, je pense souvent à : ___________",
        "A 6 ans j'ai découvert __________, je ne m'en suis jamais remis",
        "J'aime la sodomie, et je suis un gros cochon. Je suis _________",
        "Donald Trump a affirmé avoir  _________sur twitter, avant de se faire masquer ",
        "Pour mes études de vétérinaire j'ai du ________",
        "Trump vient de tweeter: 'Aujourd'hui, je vais _________'",
        "Mon plus gros fantasme : ______",
        "Les statistiques le prouvent, _______ est le meilleur moyen pour devenir célèbre",
        "Mon petit rituel du matin: _______",
        "Trump n'est pas monté au pouvoir pour la gloire, mais pour _______",
        "A mon réveil , mes draps étaient plein de sang , et de _______",
        "Désolé pour mon retard , j'ai été retenu par _______",
        "En prévision de l'apocalypse, ma cave est pleine de _______",
        "Il n'est jamais trop tard pour _____",
        "Je n'aurai jamais du parler de ______ a ce repas de famille....",
        "Au collège j'étais surnomé _____, une fierté.",
        "Voici ma dernière volonté: _______",
        "C'est grace a _____ que je suis devenu un adulte.",
        "La définition de la sélection naturelle est : ________",
        "C'est clairement la taille qui compte, quand on parle de : ________",
        "J'ai révé que je mangeais ______, une horreur.",
        "Une vie sans ______ ne vaut même pas la peine d'être vécue",
        "J'ai beau essayer d'arrêter, ______ me procure toujours une extrême juissance",
        "C'est a cause de ______ que j'ai du mal a marcher aujourd'hui",
        "Je suis toujours géné quand Mamie parle de ses histoires de _________",
        "Le septième jour, Dieu créa ______",
        "Si ____ n'existait pas, je serai encore puceau",
        "Si je ne devais emporter qu'un seul truc sur une île déserte , cela serait : ______",
        "________: La recette pour faire repartir un couple en manque d'amour",
        "_______ c'est bien, avec ta mère c'est encore mieux",
        "Harry Potter et Twilight c'est fini, maintenant les jeunes sont fans de _______",
        "La nouvelle devise de la France: Liberté, Égalité, et ______  ",
        "________ fait la force,voici la nouvelle devise belge !"
    ],
    end: [
        "Marine Lepen",
        "Un tatouage Maman sur le gland",
        "Offrir des maracass a quelqu'un atteint de la maladie de Parkinson",
        "Un jaccuzi d'urine",
        "Un régime a base de caca",
        "Offrir une arme a son enfant de 4 ans",
        "Des seins qui pendent comme des gans de toilette",
        "Une glace au lait maternel",
        "Prostituer sa belle mère",
        "Se masturber dans un aspirateur",
        "Mesurer ma bite",
        "La parodie porno de Jurassic World",
        "José de la compta",
        "Le banquier de maman",
        "Faire les bulles du Jacuzzi en pétant",
        "Une fricassée de champignons génitaux",
        "Mettre un autocollant 'Bébé a bord' sur le frigo",
        "Un bébé raciste",
        "JUL",
        "Uriner dans l'aquarium du resto chinois",
        "Trump",
        "Sperme",
        "Un pédophile déguisé en borne d'arcade avec sa bite dans le joystick",
        "Un petit garçon enchaîné dans la cave",
        "Le cousin de Marc Dutroux",
        "La circoncision au cutter",
        "Scalper un chaton",
        "Une érection de 4h",
        "Un cocktail molotov a base de cyprine",
        "Un pénis sans testicules",
        "La famine en Afrique",
        "Tout faire pour attraper un cancer",
        "Une poutre dans le cul",
        "Acheter un enfant vietnamien sur le marché noir",
        "La castration chimique.",
        "Chier des clous",
        "Sentir avant de lécher.",
        "Un travesti de 80 ans",
        "Barack Obama",
        "Se faire violer dans son sommeil",
        "Biffler une célébrité",
        "Ving milles lieux sous mémère.",
        "Une érection de 4h",
        "Le père noël qui démonte un renne.",
        "Un concombre dans le cul",
        "Une éjaculation dans l'oreille pour voir ce que ça fait",
        "Se rompre le frein",
        "Un pet qui tourne mal dans le pantalon",
        "Mamy en monokini",
        "Une biffle un peu trop violente.",
        "Pisser dans le vagin de sa meuf car flemme d'aller aux toilettes ",
        "Un membre de 32cm",
        "Le suicide par crucifixion",
        "M'autosucer",
        "Un préservatif goût bite",
        "Se faire flasher en pleine branlette au volant.",
        "Se tromper de jumelle",
        "Du concassé de juif",
        "Se faire sucer par un cannibale.",
        "L'Etat Islamique",
        "Promener un bébé en laisse",
        "Sucer après la sodomie.",
        "Ejaculer sur le chat par accident",
        "Manger gribouille",
        "Un cancer en phase terminale",
        "Un rot de pute après une dure journée.",
        "Le sacrifice humain",
        "L'inceste entre jumeaux",
        "Remplacer le lubrifiant du pot par de la colle a bois.",
        "Rentrer dans du 8 ans",
        "Un bus d'enfants leucémiques",
        "Un tétraplégique qui s'autosuce",
        "Se faire violer par Michael Jackson",
        "Je joue cette carte car toutes les autres sont nulles.",
        "Violer un nid de frelons",
        "Un coma éthylique",
        "Des nains sodomites",
        "Les femmes fontaines",
        "Une dickpick",
        "Un Gang Bang en Afrique",
        "Une haleine odeur sperme",
        "Streamer son suicide",
        "Un vagin muni d'une fermeture éclair.",
        "Maitre Gims",
        "Une perche a selfie dans le cul",
        "Le seigneur des anus",
        "Traire une femme qui alaite",
        "Une éjaculation dorsale",
        "Une strip-teaseuse qui a ses règles",
        "Un 69 avec une mamie de 69 ans",
        "Un prêtre pédophile",
        "Théo",
        "Noé",
        "Aurélie",
        "Elisa",
        "Tonton Jojo",
        "C'est qu'est ce que j'ai dis",
        "Une éjaculation faciale 'accidentelle'",
        "Chier dans le bassin des bébés nageurs",
        "Filmer sa sœur sous la douche avec un drone",
        "Passer ses vacances en Syrie",
        "Un micro pénis",
        "Une infection urinaire",
        "Violer un bébé.",
        "Prendre un selfie avec son violeur",
        "Apprendre que mon fils était roux.",
        "Une couille qui dépasse du maillot",
        "S'enfoncer les baguettes du resto japonais",
        "Sucer un tétraplégique",
        "Chier la porte ouverte",
        "Un bukkake sur une grand mère",
        "Ma bite",
        "Une golden shower",
        "Faire une gorge profonde a un cactus",
        "De la lasagne au cheval ",
        "Un clitoris de la taille d'une pomme",
        "Me branler sur Instagram",
        "Nourrir les enfants dans ma cave",
        "Donner un coup de poing a un bébé ''qui l'avait mérité''",
        "Faire une licorne a un pote qui dort",
        "Le racisme",
        "Une fiole de larmes d'enfants africains",
        "Une après-midi toucher rectal en maternelles.",
        "Offrir un changement de sexe a son fils pour noël",
        "Une soirée libertine en compagnie de mémé et de pépé",
        "Jouer a ce jeu",
        "Un tuto : Comment réussir un viol",
        "Une végan qui se demande si elle peut avaler",
        "La majorité sexuelle a 10 ans",
        "Un Gang Bang en famille",
        "Un strip-poker en famille",
        "Trouver son enfant moche",
        "Utiliser la sodomie comme moyen de contraception",
        "Un MacBite",
        "Un déguisement de licorne avec un gode comme corne",
        "De la bière a la pisse",
        "Aujourd'hui et jusqu'a ma mort je respecterai les femmes",
        "Les armes sont ",
        "Acheter un enfant sur le DarkWEB des Hackers Anonymous",
        "Une double pénétration",
        "Une triple pénétration",
        "Se faire remplir par tous les trous",
        "Clara Morgan",
        "Mia Khalifa",
        "Rocco Siffredi",
        "Un vagin recousu",
        "Un crayon dans l'urètre",
        "Un pot de colle",
        "La mère de Macron. (Oupsss... Sa femme )",
        "Utiliser un chapelet comme boule de geicha",
        "Faire semblant de s'être fait piquer par une méduse pour se pisser dessus",
        "Un bonnet de poils pubiens",
        "Se faire blanchir l'anus",
        "Un baby sitter pédophile",
        "Anne Frank",
        "Un cancer en phase terminale",
        "Se faire larguer par sa main droite",
        "Refuser de se faire retirer une tumeur car elle allonge sa bite de 2 cm",
        "Du sperme collé sur l'ordinateur familial",
        "Tuer ses spermatazoides au compas",
        "Partager par erreur une video YouPorn sur facebook",
        "L'éducation sexuelle par l'inceste",
        "Mettre de la peinture bleu blanc rouge dans son anus pour chier du dentifrice",
        "Bachar Al Assad ",
        "72 vierges ",
        "L'apartheid",
        "Crever les pneu d'un fauteuille roulant",
        "Une double pénétration nasale",
        "Transporter son urine dans une gourde pour se désaltérer",
        "Chier dans le pot de nutela",
        "Les hipsters d'extrème droite ",
        "Le sacrifice humain",
        "Ecrire la liste des courses avec son sperme",
        "La nécrophilie",
        "Un mec random",
        "SidhZG9yZSBsYSBzb2RvbWll", //CE MESSAGE A UNE VRAIE SIGNIFICATION
        "j'ai plus d'inspi",
        "Un enfant de coeur sur les genoux du prêtre"
    ]
};





var nameList = [
    'Time','Past','Future','Dev',
    'Fly','Flying','Soar','Soaring','Power','Falling',
    'Fall','Jump','Cliff','Mountain','Rend','Red','Blue',
    'Green','Yellow','Gold','Demon','Demonic','Panda','Cat',
    'Kitty','Kitten','Zero','Memory','XX','Bandit',
    'Fear','Light','Glow','Tread','Deep','Deeper','Deepest',

]; //FOR PSEUDO GENERATION


const delay = ms => new Promise(res => setTimeout(res, ms));



client = new Paho.MQTT.Client("broker.hivemq.com", 8000, "clientId-ieieeoie"+Date.now().toString().substring(8,13));
client.onConnectionLost = onConnectionLost;
client.onMessageArrived = onMessageArrived;

var app = new Vue({
    el: "#main",
    data: {
        partyCode: Date.now().toString().substring(8,13),
        partySelected: false,
        cardsManagement: false,
        pseudo: randName(),
        partyUsers: [], //FOUND 01
        played: {},
        isPlaying: false,
        isManager: false,
        isBoss: false,
        didPlay: false,
        isVoting: false,
        requiredPlayers: 3,
        cards: cards,
        playercards: [],
        start: "",
        end: "",
        winner: "",
        points: {},
        dragStatus: "retourned",
        pointstowin: 5,
        pingDelay: 5,
        didPing: false,
        lastWinner: "",
        cookieCards: {},
        selectedCookieCards: "start",
        cookieComponent: 0,
        secondsToPlay: 25,
        timerCount: 0,
        isTiming: false,

    },
    methods: {
        getPlayedCardById(id) {

            card = this.cards.end[parseInt(id)]
            console.log(id);
            return card
        },
        getScoreCircles(pseudo){
            points = this.points[pseudo];
            console.log(points)
            filled = [];
            notfilled = []
            for (var i = 0; i < points;i++){
                filled.push("filled")
            }
            for (var i = 0; i < this.pointstowin - points;i++) {
                notfilled.push("unfilled")
            }
            return {filled: filled,notfilled: notfilled}
        },
        getPlayableCards() {
            all_cards = this.playercards;
            return all_cards.slice(0, 8)
        },
        forceReload(){
            this.cookieComponent ++;
        },
        autoIncrementTimer(callback) {
            if(this.isTiming) {
                if (this.timerCount === 0) {
                    console.log("END OF TIMER");
                    this.isTiming = false;
                    randomPlay();
                    return
                }
                this.timerCount -= 1;
            }
        },
        startTimer(){
            this.timerCount = this.secondsToPlay;
            this.isTiming = true;
        }
    },
    watch: {
        isPlaying: function(now,before){
            if (now){
                setDragOn();
            }
        },
        isVoting: function(now, before){
            if (now) {
                resetPlaceholder();


            }
         },
        },
    computed: {
        cookieCardsGetter: function () {
            return this.cookieCards[this.selectedCookieCards];
        }
    },
    created() {
        window.setInterval(this.autoIncrementTimer, 1000)
    },
})
loadCookies();
function create(){
    app.partySelected = true;
    app.selection = "join";
    app.isManager = true;
    app.isBoss = true;
    app.lastWinner = app.pseudo;
    joinParty(app.partyCode);
}
async function join(){

    const { value: code } = await Swal.fire({
        title: 'Code : ',
        input: 'text',

        showCancelButton: true,
        inputValidator: (value) => {
            if (!value) {
                return 'Vous devez ecrire quelque chose'
            }
        }
    })

    if (code) {
        app.partySelected = true;
        app.selection = "join";
        joinParty(code);
    }
}
// connect the client
client.connect({onSuccess:onConnect});

function checkChange(text){
    console.log("Changed to "+text);
    app.selectedCookieCards = text;
}
function random(start=0,end){
    var my_seeded_chance = new Chance(app.pseudo+Date.now().toString()+app.partyCode+app.lastWinner);
    return Math.trunc((my_seeded_chance.integer({ min: start, max: end }) + my_seeded_chance.integer({ min: start, max: end })) / 2)

}
//CORE
function onConnect() {
    // Once a connection has been made, make a subscription and send a message.
    console.log("Connected to Multiplayer System");
    const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    if (urlParams.has("code")){
        joinParty(urlParams.get("code"));
    }
    // sendJson({"type":"join","data":{"id": 5}},"1656263");
    //message = new Paho.MQTT.Message("Hello");
    //message.destinationName = "World";
    //client.send(message);
}
function onConnectionLost(responseObject) {
    if (responseObject.errorCode !== 0) {
        console.log("onConnectionLost:"+responseObject.errorMessage);
    }
}
function sendJson(json,topic=app.partyCode){
    string = JSON.stringify(json);
    message = new Paho.MQTT.Message(string);
    message.destinationName = topic;
    client.send(message);

}
function randomChoice(arr) { //TODO: Ameliorer random car pourri
    //return arr[Math.floor(arr.length * Math.random())];
    return arr[random(0,arr.length)];
}
function makeRequest(type,data){
    return {"limiteboloss":{
            messageType: type,
            data: data
        }}
}
function shuffle(array) {
    array = array.slice();
    var currentIndex = array.length, temporaryValue, randomIndex;

    // While there remain elements to shuffle...
    while (0 !== currentIndex) {

        // Pick a remaining element...
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex -= 1;

        // And swap it with the current element.
        temporaryValue = array[currentIndex];
        array[currentIndex] = array[randomIndex];
        array[randomIndex] = temporaryValue;
    }

    return array;
}
function chunkify(a, n, balanced) {

    if (n < 2)
        return [a];

    var len = a.length,
        out = [],
        i = 0,
        size;

    if (len % n === 0) {
        size = Math.floor(len / n);
        while (i < len) {
            out.push(a.slice(i, i += size));
        }
    }

    else if (balanced) {
        while (i < len) {
            size = Math.ceil((len - i) / n--);
            out.push(a.slice(i, i += size));
        }
    }

    else {

        n--;
        size = Math.floor(len / n);
        if (len % size === 0)
            size--;
        while (i < size * n) {
            out.push(a.slice(i, i += size));
        }
        out.push(a.slice(size * n));

    }

    return out;
}
function removeCard(array,index){
    result = []
    carte = app.cards.end[parseInt(index)];

    for (ar_ind in array){
        if (array[ar_ind].card != carte){
            result.push(array[ar_ind]);
        }else{
            console.log(array[ar_ind]+" != "+card)
        }
    }
    return result;
}
function randName(){
    finalName = nameList[Math.floor( Math.random() * nameList.length )];
    finalName += nameList[Math.floor( Math.random() * nameList.length )];
    return finalName;
};
function loadCookies(){
    var cards = Cookies.get("cards");
    if(cards === undefined) {
        cards = {start:[],end:[]}
    }else{
        cards = JSON.parse(cards);
    }


    app.cookieCards = cards;

}
function manageCards(){
    app.cardsManagement = true;
}
function addCookieCard(){
    app.cookieCards[app.selectedCookieCards].push("");
    app.forceReload();
}
function saveCookieCard(){
    cards = app.cookieCards;
    final = {start:[],end:[]}
    for (card_i in cards.start){
        card = cards.start[card_i];
        if(card.length > 0){
            final.start.push(card)
        }
    }
    for (card_i in cards.end){
        card = cards.end[card_i];

        if(card.length > 0){
            final.end.push(card)
        }
    }
    Swal.fire({
        icon: 'success',
        title: 'Parfait',
        text: 'Tout a bien été sauvegardé',
    })
    Cookies.set("cards",JSON.stringify(final),{ expires: 36500 });
    app.cookieCards = final;
    app.forceReload();

}
function randomPlay(){
    var cards = document.getElementsByClassName("end")[0].childNodes;
    const carddiv = cards[Math.floor(Math.random() * cards.length)];
    var placeholder = document.getElementById("placeholder")
    placeholder.appendChild(carddiv);
    var card = carddiv.firstChild

    var value = card.getAttribute("value");
    console.log("Automatic Played : "+value);
    sendPlayedCard(value);
}
function joinParty(code){
    loadCookies();
    SyncCards(app.cookieCards);
    client.unsubscribe(app.partyCode)
    app.partyCode = code;
    app.partySelected = true;
    client.subscribe(app.partyCode);


    sendJson({"limiteboloss":{
            messageType: "join",
            data: {
                pseudo: app.pseudo,
                cards: app.cards
            }
        }}, app.partyCode);

} //JOIN PARTY WITH CODE


//EVENTS
function sendUserList(){
    sendJson({"limiteboloss":{
            messageType: "userlist",
            data: {
                users: app.partyUsers,
                cards: app.cards
            }
        }}, app.partyCode);
}//SHARE USERS LIST
function sendStart()
{

    users = app.partyUsers;
    party_cards = {}

    if(app.playercards.length < 1) {
        deck_end = shuffle(app.cards.end);
        console.log(deck_end)
        splitted = chunkify(deck_end,users.length,true)
        for (let user_id in users) {
            user = users[user_id];
            party_cards[user] = []
            user_cards_list = splitted[user_id];
            for (card_id in user_cards_list){
                index = app.cards.end.indexOf(user_cards_list[card_id]);
                party_cards[user].push({card: user_cards_list[card_id], index: index})

            }
            /*for (var i = 0; i < 7; i++) {
                card = deck_end.pop()
                index = app.cards.end.indexOf(card)
                party_cards[user].push({card: card, index: index})
            }*/
        }
    }

    console.log(party_cards);




    sendJson({"limiteboloss":{
            messageType: "start",
            data: {
                cards: party_cards
            }
        }}, app.partyCode);
} //SEND START EVENT ( Only game manager )
function sendPlayedCard(value){
    app.isTiming = false;
    console.log(value);
    sendJson(makeRequest("play",{card: value,pseudo: app.pseudo}), app.partyCode);
    app.didPlay = true;

}
function vote(winner){
    //winner = $( "#vote" ).val();
    sendJson(makeRequest("vote",{pseudo: winner}), app.partyCode);
    app.isVoting = false;

}

//REACTIONS
function addUser(data){
    if(!app.isPlaying){
        console.log("USER ADDED : "+data["pseudo"])
        app.partyUsers.push(data["pseudo"]);
        app.points[data.pseudo] = 0;
        console.log("CARDS GETTED");
        console.log(data.cards);
        SyncCards(data.cards);
        sendUserList();
    }


} //ADD USER LOCALLY AND SHARE IT
function SyncList(data){
    if(app.partyUsers.length < data["users"].length ){
        console.log("SYNC");
        console.log("GETS USERS : ");
        console.log(data.users);
        console.log(data.users[0]);

        app.partyUsers = data.users;
        app.lastWinner = app.partyUsers[0];
        resetPoints();
        console.log("CARDS GETTED");
        console.log(data.cards);
        SyncCards(data.cards);
    }

} //SYNC USER LIST WITH OTHERS*
function SyncCards(cardsToAdd){
    app.cards.start = [...new Set([...app.cards.start, ...cardsToAdd.start])].sort();
    app.cards.end = [...new Set([...app.cards.end, ...cardsToAdd.end])].sort();
    console.log("Cards Synced");

}
function resetPoints(){
    for (user in app.partyUsers){
        console.log("USER POINTS RESET : "+app.partyUsers[user])
        app.points[app.partyUsers[user]] = 0;
    }
} //RESET ALL POINTS AT START
function startParty(data){
    if (app.playercards.length < 1) {
        app.playercards = data.cards[app.pseudo];
    }
    console.log("MY CARDS : ")
    console.log(app.playercards);
    app.isPlaying = true;

    if (app.isBoss){
        start_card = randomChoice(app.cards.start);
        console.log(start_card);
        sendJson({"limiteboloss":{
                messageType: "startcard",
                data: {
                    card: start_card
                }
            }});
    }
} //START PARTY
function addPlayedCard(data){
    app.played[data.pseudo] = data.card;
    if (Object.keys(app.played).length >= app.partyUsers.length - 1){
        app.isVoting = true;
    }
} //ADD OTHER PLAYER PLAYED CARD TO PLAYED CARDS
async function resetByVote(data){
    winner = data.pseudo;
    console.log("AND THE WINNER IS "+winner);

    app.points[winner] ++;
    app.lastWinner = winner;
    app.winner = winner;
    await delay(3000);
    app.isBoss = false;
    app.played = {};
    app.didPlay =  false;
    app.isVoting = false;
    if(app.points[winner] >= app.pointstowin){
        console.log("ANNNNND THE BIIIIIIIIIIIIIIG WINNNNER IS "+ winner);
        document.body.innerHTML = "<h1>END</h1>";
        Swal.fire({
            title: 'Partie finie !',
            text: "Le gagnant est : "+winner,
            showCancelButton: false,
            confirmButtonColor: '#3085d6',
            confirmButtonText: 'Ok'
        }).then((result) => {
            if (result.value) {
                document.location.reload(true);
            }
        })
    }else{
        console.log(app.points[winner]+" < "+app.pointstowin);
    }
    resetPlaceholder();
    if (winner === app.pseudo){
        app.isBoss = true;
        sendStart();
        console.log("I'm the winner");
    }
    app.winner = "";



} //REWARD WINNER AND RESET GAME ROUND
function resetPlaceholder(){
    placeholder = document.getElementById("placeholder");
    placeholder.innerHTML = "";
    placeholder.classList.remove("draggable-dropzone--occupied");
}
function setStartCard(data){
    if(!app.isBoss) {
        app.startTimer();
    }
    app.start = data.card
} //SET START CARD



//DRAG AND DROP SUPPORT
function setDragNDrop(status){
    app.dragStatus = status;
}

function DragNDrop(){
    console.log("AH")
    if(app.dragStatus === "dropped"){
        placeholder = document.getElementById("placeholder")
        div = placeholder.firstChild
        card = div.firstChild
        if (div.getAttribute("type") === "play") {
            value = card.getAttribute("value");
            console.log("Played : "+value);
            sendPlayedCard(value);
            app.playercards = removeCard(app.playercards,value);
        }else if(div.getAttribute("type") === "vote"){
            pseudo = card.getAttribute("value");
            vote(pseudo);


        }
    }
}

//EVENT LISTENER
function onMessageArrived(message) {
    try {
        content = JSON.parse(message.payloadString);
    }catch (e) {
        return;

    }
    if ("limiteboloss" in content){
        content = content["limiteboloss"];
        console.log(content);
        switch (content.messageType) {
            default:
                console.log(content.type+" ---> ");
                console.log(content.data);
                break;
            case "join":
                addUser(content.data);
                break;
            case "userlist":
                SyncList(content.data);
                break;
            case "start":
                startParty(content.data);
                break;
            case 'startcard':
                setStartCard(content.data);
                break;
            case 'play':
                addPlayedCard(content.data);
                break;
            case 'vote':
                resetByVote(content.data);
                break;


        }
    }
}


